local hero_table = 
{
	["npc_dota_hero_riki"] = {
		old = {
			"riki_smoke_screen",
			"riki_blink_strike",
			"riki_permanent_invisibility",
			"riki_tricks_of_the_trade",
		},
		new = {
			"angel_arena_envenomed",
			"angel_arena_strike",
			"angel_arena_dash",
			"juggernaut_omni_slash",
		},
	},

	["npc_dota_hero_axe"] = {
		old = {
			"axe_berserkers_call",
			"axe_battle_hunger",
			"axe_counter_helix",
			"axe_culling_blade",
		},
		new = {
			"angel_arena_earthspikes",
			"angel_arena_revenge",
			"angel_arena_dash",
			"angel_arena_roots",
		},
	},

	["npc_dota_hero_juggernaut"] = {
		old = {
			"juggernaut_blade_fury",
			"juggernaut_healing_ward",
			"juggernaut_blade_dance",
			"angel_arena_nether_ritual",
			"juggernaut_omni_slash",			
		},
		new = {
			"angel_arena_berserk",
			"angel_arena_evasion",
			"angel_arena_dash",
			"angel_arena_nether_ritual",
		},
	},

	["npc_dota_hero_faceless_void"] = {
		old = {
			"faceless_void_time_walk",
			"faceless_void_time_dilation",
			"faceless_void_time_lock",
			"faceless_void_chronosphere",
		},
		new = {
			"naga_siren_mirror_image",
			"angel_arena_fast_aura",
			"angel_arena_dash",
			"juggernaut_omni_slash",
		},
	},

	["npc_dota_hero_antimage"] = {
		old = {
			"antimage_mana_break",
			"antimage_blink",
			"antimage_spell_shield",
			"antimage_mana_void",
		},
		new = {
			"angel_arena_magic_fire",
			"angel_arena_firehell",
			"angel_arena_death_aura",
			"angel_arena_demonic",
		},
	},

	["npc_dota_hero_bloodseeker"] = {
		old = {
			"bloodseeker_bloodrage",
			"bloodseeker_blood_bath",
			"bloodseeker_thirst",
			"bloodseeker_rupture",
		},
		new = {
			"spike_dash",
			"angel_arena_heal_ward",
			"angel_arena_shell",
			"angel_arena_faerie",
		},
	},

	["npc_dota_hero_batrider"] = {
		old = {
			"batrider_sticky_napalm",
			"batrider_flamebreak",
			"batrider_firefly",
			"batrider_flaming_lasso",
		},
		new = {
			"angel_arena_cripple",
			"angel_arena_lightning",
			"angel_arena_summon_hawk",
			"angel_arena_enrage",
		},
	},

	["npc_dota_hero_storm_spirit"] = {
		old = {
			"storm_spirit_static_remnant",
			"storm_spirit_electric_vortex",
			"storm_spirit_overload",
			"storm_spirit_ball_lightning",
		},
		new = {
			"angel_arena_storm",
			"angel_arena_evasion",
			"angel_arena_dash",
			"juggernaut_omni_slash",
		},
	},

	["npc_dota_hero_sniper"] = {
		old = {
			"sniper_shrapnel",
			"sniper_headshot",
			"sniper_take_aim",
			"sniper_assassinate",
		},
		new = {
			"angel_arena_rifle",
			"angel_arena_shot",
			"angel_arena_dash",
			"angel_arena_gunpowder",
		},
	},

	["npc_dota_hero_vengefulspirit"] = {
		old = {
			"vengefulspirit_magic_missile",
			"vengefulspirit_wave_of_terror",
			"vengefulspirit_command_aura",
			"vengefulspirit_nether_swap",
		},
		new = {
			"angel_arena_face_of_death",
			"angel_arena_souls",
			"angel_arena_sleep",
			"angel_arena_song",
		},
	},

	["npc_dota_hero_life_stealer"] = {
		old = {
			"life_stealer_rage",
			"life_stealer_feast",
			"life_stealer_open_wounds",
			"life_stealer_assimilate",
			"life_stealer_assimilate_eject",
			"life_stealer_infest",
			"life_stealer_control",
			"life_stealer_consume",
			"attribute_bonus",

		},
		new = {
			"angel_arena_hammer",
			"angel_arena_envenomed",
			"angel_arena_shell",
			"angel_arena_reincarnation",
			"attribute_bonus",
		}
	},

	["npc_dota_hero_chen"] = {
		old = {
			"chen_penitence",
			"chen_test_of_faith",
			"chen_test_of_faith_teleport",
			"chen_holy_persuasion",
			"chen_hand_of_god",
		},
		new = {
			"angel_arena_shadow_dagger",
			"ursa_fury_swipes",
			"angel_arena_archer_aura",
			"angel_arena_transmute",
		},
	},
	
	["npc_dota_hero_clinkz"] = {
		old = {
			"clinkz_strafe",
			"clinkz_searing_arrows",
			"clinkz_wind_walk",
			"clinkz_death_pact",
		},
		new = {
			"angel_arena_curse",
			"angel_arena_envenomed",
			"angel_arena_archer_aura",
			"angel_arena_darkrage",
		},
	},

	["npc_dota_hero_keeper_of_the_light"] = {
		old = {
			"keeper_of_the_light_illuminate",
			"keeper_of_the_light_mana_leak",
			"keeper_of_the_light_chakra_magic",
			"keeper_of_the_light_recall",
			"keeper_of_the_light_blinding_light",
			"keeper_of_the_light_spirit_form",
			"keeper_of_the_light_illuminate_end",
			"keeper_of_the_light_spirit_form_illuminate",
			"keeper_of_the_light_spirit_form_illuminate_end",
			"attribute_bonus",
		},
		new = {
			"angel_arena_holahammer",
			"angel_arena_grace",
			"angel_arena_hola_heal",
			"angel_arena_faerie",
			"attribute_bonus",
		},
	},
	
	["npc_dota_hero_doom_bringer"] = {
		old = {
			"doom_bringer_devour",
			"doom_bringer_scorched_earth",
			"doom_bringer_infernal_blade",
			"doom_bringer_empty1",
			"doom_bringer_empty2",
			"doom_bringer_doom",
			"attribute_bonus",
		},
		new = {
			"naga_siren_mirror_image",
			"angel_arena_immobilise",
			"angel_arena_vampire",
			"angel_arena_dooms",
			"attribute_bonus",
		},
	},
}

function RebornHero(keys)
	local caster = keys.caster
	if not caster:IsRealHero() then return end
	
	if DuelLibrary:IsDuelActive() then return end
	if nCOUNTDOWNTIMER < 30 then return end

	local playerid = caster:GetPlayerOwnerID() 
	local player = caster:GetPlayerOwner()
	local heroname = caster:GetUnitName() 
	local level = caster:GetLevel() 

	local mc = caster:GetModifierCount()
	for i = 0, mc do 
		print(caster:GetModifierNameByIndex(i))
	end 

	if hero_table[heroname] then
		if not caster.reborn then 
			for _, x in pairs(hero_table[heroname].new) do
				caster:RemoveAbility(x) 
			end

			for _, x in pairs(hero_table[heroname].old) do
				caster:AddAbility(x)
			end

			caster.reborn = true
		else
			for _, x in pairs(hero_table[heroname].old) do
				caster:RemoveAbility(x)
			end
			for i = 0, caster:GetAbilityCount() - 1 do
				local current_ability = caster:GetAbilityByIndex(i)
				if current_ability then 
					caster:RemoveAbility(current_ability:GetName() ) 
				end
			end

			for _, x in pairs(hero_table[heroname].new) do
				caster:AddAbility(x) 
			end

			caster.reborn = false
		end

		caster:RemoveAbility("attribute_bonus")
		caster:AddAbility("attribute_bonus")
		caster:SetAbilityPoints(level)

		if heroname == "npc_dota_hero_riki" then
			caster:RemoveModifierByName("modifier_riki_blinkstrike_chargecounter")
			caster:RemoveModifierByName("modifier_riki_permanent_invisibility")
		end
		if heroname == "npc_dota_hero_chen" then
			caster:RemoveModifierByName("modifier_archer_aura")
			caster:RemoveModifierByName("modifier_archer_aura_radius")
		end
		if heroname == "npc_dota_hero_faceless_void" then
			while caster:HasModifier("modifier_fast_aura") do
				caster:RemoveModifierByName("modifier_fast_aura_emitter")
				caster:RemoveModifierByName("modifier_fast_aura")
			end
		end
		if heroname == "npc_dota_hero_antimage" then
			while caster:HasModifier("modifier_death_aura") do
				caster:RemoveModifierByName("modifier_death_aura_emiter")
				caster:RemoveModifierByName("modifier_death_aura") 
			end
		end
		if heroname == "npc_dota_hero_sniper" then
			caster:RemoveModifierByName("modifier_sniper_machine_gun")
			caster:RemoveModifierByName("modifier_sniper_rifle")
			caster:RemoveModifierByName("modifier_sniper_shrapnel_charge_counter")

		end
		if heroname == "npc_dota_hero_keeper_of_the_light" then
			caster:RemoveModifierByName("modifier_keeper_of_the_light_spirit_form")
		end

		if heroname == "npc_dota_hero_bloodseeker" then
			if not caster:HasModifier("modifier_bloodseeker_rupture_charge_counter") then
				if caster:HasAbility("bloodseeker_rupture") then
					for i = 0, caster:GetAbilityCount() - 1 do
						local ability = caster:GetAbilityByIndex(i)
						if ability and ability:GetName() == "bloodseeker_rupture" then
							caster:AddNewModifier(caster, ability, "modifier_bloodseeker_rupture_charge_counter", {})
							caster:SetModifierStackCount("modifier_bloodseeker_rupture_charge_counter", ability, 1)
							print(caster:GetModifierStackCount( "modifier_bloodseeker_rupture_charge_counter", ability ))
						end
					end
				end
			else
				caster:RemoveModifierByName("modifier_bloodseeker_rupture_charge_counter")
			end

		end

		if heroname == "npc_dota_hero_storm_spirit" then
			if caster.reborn == true then
				--[[
				0 = strength, 1 = agility, 2 = intelligence.
				]]
				caster:SetPrimaryAttribute(2)
			else
				caster:SetPrimaryAttribute(1)
			end
		end
		caster:ForceKill(true)
	end
end